

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Morton Industries RFQ / Quote Intake</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; color: #111; }
    .card { max-width: 920px; padding: 18px; border: 1px solid #ddd; border-radius: 10px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .field { flex: 1; min-width: 240px; margin: 10px 0; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input[type="text"], input[type="number"], select, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
      font-size: 14px; box-sizing: border-box;
    }
    textarea { min-height: 90px; }
    .hint { font-size: 12px; color: #555; margin-top: 6px; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; color: #111; }
    pre { white-space: pre-wrap; background: #f7f7f7; padding: 12px; border-radius: 8px; border: 1px solid #eee; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .divider { height: 1px; background: #eee; margin: 16px 0; }
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0 0 8px 0;">RFQ / Quote Intake</h2>
    <div class="hint">Fill out the questionnaire and attach any drawings / RFQ docs. You can select multiple files.</div>

    <form id="rfqForm">
      <!-- =========================
           QUESTIONNAIRE SECTION
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">Questionnaire</h3>

      <div class="row">
        <div class="field">
          <label for="rfqNumber">RFQ Number</label>
          <input id="rfqNumber" name="rfqNumber" type="text" placeholder="RFQ-12345" />
        </div>

        <div class="field">
          <label for="quoteNumber">Quote Number (if assigned)</label>
          <input id="quoteNumber" name="quoteNumber" type="text" placeholder="Q-67890" />
        </div>

        <div class="field">
          <label for="customerName">Customer</label>
          <input id="customerName" name="customerName" type="text" placeholder="Customer name" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="enclosureType">Enclosure Type</label>
          <select id="enclosureType" name="enclosureType">
            <option value="">Select…</option>
            <option value="MCB">MCB</option>
            <option value="PNL">PNL</option>
            <option value="MCB+PNL">MCB + PNL</option>
          </select>
          <div class="hint">Use your existing options here if different.</div>
        </div>

        <div class="field">
          <label for="application">Application</label>
          <select id="application" name="application">
            <option value="">Select…</option>
            <option value="UL891">UL891</option>
            <option value="UL508A">UL508A</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="field">
          <label for="plant">Preferred Plant</label>
          <select id="plant" name="plant">
            <option value="">Default (Fort Worth, TX)</option>
            <option value="Fort Worth, TX">Fort Worth, TX</option>
            <option value="Tennessee">Tennessee</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="mcbDimensions">MCB Dimensions (HxWxD)</label>
          <input id="mcbDimensions" name="mcbDimensions" type="text" placeholder='e.g. 15x14x21' />
        </div>

        <div class="field">
          <label for="pnlDimensions">PNL Dimensions (HxWxD)</label>
          <input id="pnlDimensions" name="pnlDimensions" type="text" placeholder='e.g. 20x20x10' />
        </div>

        <div class="field">
          <label for="material">Material</label>
          <select id="material" name="material">
            <option value="">Select…</option>
            <option value="Stainless">Stainless</option>
            <option value="Carbon Steel">Carbon Steel</option>
            <option value="Aluminum">Aluminum</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="qty">Requested Quantity (base)</label>
          <input id="qty" name="qty" type="number" min="1" step="1" value="1" />
        </div>

        <div class="field">
          <label for="includeSkid">Include Skid?</label>
          <select id="includeSkid" name="includeSkid">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="field">
          <label for="color">Finish / Color</label>
          <input id="color" name="color" type="text" placeholder="e.g. Blue, ANSI 61, etc." />
        </div>
      </div>

      <div class="field">
        <label for="notes">Notes / Requirements</label>
        <textarea id="notes" name="notes" placeholder="Add any special requirements, cutouts, latches, NEMA rating, etc."></textarea>
      </div>

      <!-- =========================
           FILE UPLOAD SECTION (ADDED)
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">Attachments</h3>

      <div class="field">
        <label for="rfqFiles">Upload files (multiple allowed)</label>
        <input id="rfqFiles" name="files" type="file" multiple />
        <div id="rfqFilesList" class="mono hint">No files selected.</div>
        <div class="hint">Supported: PDF, XLSX, DOCX, images. Select multiple files in one upload.</div>
      </div>

      <div class="divider"></div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="primary" type="submit">Submit to n8n</button>
        <button class="secondary" type="button" id="clearBtn">Clear</button>
      </div>
    </form>

    <div class="divider"></div>
    <h3 style="margin:0 0 8px 0;">Status</h3>
    <pre id="status" class="mono">Idle.</pre>
  </div>

  <script>
    // ========= CONFIG =========
    // Replace this with your actual n8n Webhook URL
    const WEBHOOK_URL = "https://YOUR_N8N_DOMAIN/webhook/rfq-upload";
    // ==========================

    const form = document.getElementById("rfqForm");
    const statusEl = document.getElementById("status");
    const clearBtn = document.getElementById("clearBtn");
    const filesEl = document.getElementById("rfqFiles");
    const fileListEl = document.getElementById("rfqFilesList");

    function renderSelectedFiles() {
      const files = Array.from(filesEl.files || []);
      if (!files.length) {
        fileListEl.textContent = "No files selected.";
        return;
      }
      fileListEl.textContent = files
        .map((f, i) => `${i + 1}. ${f.name} (${Math.round(f.size / 1024)} KB)`)
        .join("\n");
    }

    filesEl.addEventListener("change", renderSelectedFiles);
    renderSelectedFiles();

    clearBtn.addEventListener("click", () => {
      form.reset();
      // Reset file list UI
      fileListEl.textContent = "No files selected.";
      statusEl.textContent = "Cleared.";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      statusEl.textContent = "Submitting...";

      // IMPORTANT:
      // We use FormData so files are sent as multipart/form-data binaries.
      // This includes all questionnaire fields automatically.
      const fd = new FormData(form);

      // Ensure multi-file upload: append each file under the SAME key "files"
      // (Some browsers already include it via FormData(form), but this is explicit and reliable.)
      fd.delete("files");
      const files = Array.from(filesEl.files || []);
      for (const f of files) {
        fd.append("files", f, f.name);
      }

      // Optional: include a count for easier debugging in n8n
      fd.append("uploadCount", String(files.length));

      try {
        const res = await fetch(WEBHOOK_URL, { method: "POST", body: fd });

        const contentType = res.headers.get("content-type") || "";
        let bodyText;
        if (contentType.includes("application/json")) {
          const json = await res.json();
          bodyText = JSON.stringify(json, null, 2);
        } else {
          bodyText = await res.text();
        }

        statusEl.textContent =
          `Server response (${res.status})\n` +
          `Files sent: ${files.length}\n\n` +
          bodyText;

      } catch (err) {
        statusEl.textContent = "Submit failed: " + err.message;
      }
    });
  </script>
</body>
</html>
