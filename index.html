<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Morton Industries RFQ / Quote Intake</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; color: #111; }
    .card { max-width: 920px; padding: 18px; border: 1px solid #ddd; border-radius: 10px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .field { flex: 1; min-width: 240px; margin: 10px 0; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input[type="text"], input[type="number"], select, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
      font-size: 14px; box-sizing: border-box;
    }
    textarea { min-height: 90px; }
    .hint { font-size: 12px; color: #555; margin-top: 6px; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
    button.primary { background: #111; color: #fff; }
    button.secondary { background: #eee; color: #111; }
    pre { white-space: pre-wrap; background: #f7f7f7; padding: 12px; border-radius: 8px; border: 1px solid #eee; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .divider { height: 1px; background: #eee; margin: 16px 0; }
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0 0 8px 0;">RFQ / Quote Intake</h2>
    <div class="hint">Fill out the questionnaire and attach any drawings / RFQ docs. You can select multiple files.</div>

    <form id="rfqForm">
      <!-- =========================
           INTEGRATION SECTION
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">Integration</h3>

      <div class="field">
        <label for="webhookUrl">n8n Webhook URL</label>
        <input
          id="webhookUrl"
          name="webhookUrl"
          type="text"
          class="mono"
          placeholder="https://n8n.yourdomain.com/webhook/xyz"
          required
        />
        <div class="hint">This is the n8n webhook that will receive the RFQ + files. It will be saved in this browser.</div>
      </div>

      <!-- =========================
           QUESTIONNAIRE SECTION
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">Questionnaire</h3>

      <div class="row">
        <div class="field">
          <label for="rfqNumber">RFQ Number</label>
          <input id="rfqNumber" name="rfqNumber" type="text" placeholder="RFQ-12345" />
        </div>

        <div class="field">
          <label for="customerName">Customer</label>
          <input id="customerName" name="customerName" type="text" placeholder="Customer name" />
        </div>

        <div class="field">
          <label for="enclosureType">Enclosure Type</label>
          <input id="enclosureType" name="enclosureType" type="text" list="enclosureTypeList" placeholder="Select or type…" />
          <datalist id="enclosureTypeList">
            <option value="MCB"></option>
            <option value="PNL"></option>
            <option value="MCB + PNL"></option>
          </datalist>
          <div class="hint">Pick from the list or type a custom enclosure type.</div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="application">Compliance / Certification Rating</label>
          <input id="application" name="application" type="text" list="applicationList" placeholder="Select or type…" />
          <datalist id="applicationList">
            <option value="NEMA 3R (Outdoor)"></option>
            <option value="NEMA 12 (Indoor)"></option>
          </datalist>
        </div>

        <div class="field">
          <label for="plant">Preferred Plant</label>
          <input id="plant" name="plant" type="text" list="plantList" placeholder="Default (Fort Worth, TX) or type…" />
          <datalist id="plantList">
            <option value="Fort Worth, TX"></option>
            <option value="Tennessee"></option>
          </datalist>
        </div>

        <div class="field">
          <label for="qty">Requested Quantity (base)</label>
          <input id="qty" name="qty" type="number" min="1" step="1" value="1" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="mcbDimensions">MCB Dimensions (HxWxD)</label>
          <input id="mcbDimensions" name="mcbDimensions" type="text" placeholder='e.g. 15x14x21' />
        </div>

        <div class="field">
          <label for="pnlDimensions">PNL Dimensions (HxWxD)</label>
          <input id="pnlDimensions" name="pnlDimensions" type="text" placeholder='e.g. 20x20x10' />
        </div>

        <div class="field">
          <label for="includeSkid">Include Skid?</label>
          <input id="includeSkid" name="includeSkid" type="text" list="includeSkidList" placeholder="Select or type…" value="no" />
          <datalist id="includeSkidList">
            <option value="no"></option>
            <option value="yes"></option>
          </datalist>
        </div>
      </div>

      <!-- =========================
           MCB CONFIG (ADDED)
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">MCB</h3>

      <div class="row">
        <div class="field">
          <label for="mcbMaterial">MCB Material</label>
          <input id="mcbMaterial" name="mcbMaterial" type="text" list="materialList" placeholder="Select or type…" />
          <datalist id="materialList">
            <option value="Stainless"></option>
            <option value="Carbon Steel"></option>
            <option value="Aluminum"></option>
          </datalist>
        </div>

        <div class="field">
          <label for="mcbFinish">MCB Finish / Color</label>
          <input id="mcbFinish" name="mcbFinish" type="text" placeholder="e.g. Blue, ANSI 61, etc." />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="mcbDoorCount">MCB Number of Doors</label>
          <input id="mcbDoorCount" name="mcbDoorCount" type="number" min="0" step="1" value="1" />
          <div class="hint">Set to 0 if no doors.</div>
        </div>

        <div class="field">
          <label for="mcbLatchType">MCB Latch Type</label>
          <input id="mcbLatchType" name="mcbLatchType" type="text" list="latchList" placeholder="Select or type…" />
          <datalist id="latchList">
            <option value="3-point"></option>
            <option value="Quarter-turn"></option>
            <option value="Padlockable"></option>
            <option value="Keyed"></option>
            <option value="Handle"></option>
          </datalist>
        </div>
      </div>

      <!-- =========================
           PNL/PCB CONFIG (ADDED)
           NOTE: User asked "PCB" - leaving it as PCB section label,
           but keeping existing PNL dimensions field unchanged.
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">PCB</h3>

      <div class="row">
        <div class="field">
          <label for="pcbMaterial">PCB Material</label>
          <input id="pcbMaterial" name="pcbMaterial" type="text" list="materialList2" placeholder="Select or type…" />
          <datalist id="materialList2">
            <option value="Stainless"></option>
            <option value="Carbon Steel"></option>
            <option value="Aluminum"></option>
          </datalist>
        </div>

        <div class="field">
          <label for="pcbFinish">PCB Finish / Color</label>
          <input id="pcbFinish" name="pcbFinish" type="text" placeholder="e.g. Blue, ANSI 61, etc." />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="pcbDoorCount">PCB Number of Doors</label>
          <input id="pcbDoorCount" name="pcbDoorCount" type="number" min="0" step="1" value="1" />
          <div class="hint">Set to 0 if no doors.</div>
        </div>

        <div class="field">
          <label for="pcbLatchType">PCB Latch Type</label>
          <input id="pcbLatchType" name="pcbLatchType" type="text" list="latchList2" placeholder="Select or type…" />
          <datalist id="latchList2">
            <option value="3-point"></option>
            <option value="Quarter-turn"></option>
            <option value="Padlockable"></option>
            <option value="Keyed"></option>
            <option value="Handle"></option>
          </datalist>
        </div>
      </div>

      <div class="field">
        <label for="notes">Notes / Requirements</label>
        <textarea id="notes" name="notes" placeholder="Add any special requirements, cutouts, latches, NEMA rating, etc."></textarea>
      </div>

      <!-- =========================
           FILE UPLOAD SECTION
           ========================= -->
      <div class="divider"></div>
      <h3 style="margin:0 0 8px 0;">Attachments</h3>

      <div class="field">
        <label for="rfqFiles">Upload files (multiple allowed)</label>
        <input id="rfqFiles" name="files" type="file" multiple />
        <div id="rfqFilesList" class="mono hint">No files selected.</div>
        <div class="hint">Supported: PDF, XLSX, DOCX, images. Select multiple files in one upload.</div>
      </div>

      <div class="divider"></div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="primary" type="submit">Submit to n8n</button>
        <button class="secondary" type="button" id="clearBtn">Clear</button>
      </div>
    </form>

    <div class="divider"></div>
    <h3 style="margin:0 0 8px 0;">Status</h3>
    <pre id="status" class="mono">Idle.</pre>
  </div>

  <script>
    const form = document.getElementById("rfqForm");
    const statusEl = document.getElementById("status");
    const clearBtn = document.getElementById("clearBtn");
    const filesEl = document.getElementById("rfqFiles");
    const fileListEl = document.getElementById("rfqFilesList");
    const webhookInput = document.getElementById("webhookUrl");

    function renderSelectedFiles() {
      const files = Array.from(filesEl.files || []);
      if (!files.length) {
        fileListEl.textContent = "No files selected.";
        return;
      }
      fileListEl.textContent = files
        .map((f, i) => `${i + 1}. ${f.name} (${Math.round(f.size / 1024)} KB)`)
        .join("\n");
    }

    // Load saved webhook URL (if any)
    const savedWebhook = localStorage.getItem("n8nWebhookUrl");
    if (savedWebhook) webhookInput.value = savedWebhook;

    // Save webhook URL when changed
    webhookInput.addEventListener("change", () => {
      localStorage.setItem("n8nWebhookUrl", webhookInput.value.trim());
    });

    filesEl.addEventListener("change", renderSelectedFiles);
    renderSelectedFiles();

    clearBtn.addEventListener("click", () => {
      form.reset();

      // Restore webhook URL after reset (since it's intentionally persisted)
      const saved = localStorage.getItem("n8nWebhookUrl");
      if (saved) webhookInput.value = saved;

      // Reset file list UI
      fileListEl.textContent = "No files selected.";
      statusEl.textContent = "Cleared.";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const webhookUrl = (webhookInput.value || "").trim();

      if (!webhookUrl || !/^https?:\/\//i.test(webhookUrl)) {
        statusEl.textContent = "Please enter a valid n8n Webhook URL (must start with http:// or https://).";
        return;
      }

      statusEl.textContent = "Submitting...";

      const fd = new FormData(form);

      // Ensure multi-file upload under the same key "files"
      fd.delete("files");
      const files = Array.from(filesEl.files || []);
      for (const f of files) {
        fd.append("files", f, f.name);
      }

      fd.append("uploadCount", String(files.length));

      try {
        const res = await fetch(webhookUrl, { method: "POST", body: fd });

        const contentType = res.headers.get("content-type") || "";
        let bodyText;
        if (contentType.includes("application/json")) {
          const json = await res.json();
          bodyText = JSON.stringify(json, null, 2);
        } else {
          bodyText = await res.text();
        }

        statusEl.textContent =
          `Server response (${res.status})\n` +
          `Files sent: ${files.length}\n\n` +
          bodyText;

      } catch (err) {
        statusEl.textContent = "Submit failed: " + err.message;
      }
    });
  </script>
</body>
</html>
